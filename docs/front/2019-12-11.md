---
title: 'çœŸé¦™ï¼GitHub Actionä¸€é”®éƒ¨ç½²'
description: HerryLo, å¾®ä¿¡å…¬ä¼—å·ï¼š Yopai
date: 2019-12-11 00:00
tags: 
  - GitHub Action
---

# çœŸé¦™ï¼GitHub Actionä¸€é”®éƒ¨ç½²

[ä½œè€…ï¼šHerryLo](https://github.com/HerryLo)
[åšå®¢åŸæ–‡é“¾æ¥](https://github.com/AttemptWeb/Record/issues/19)

æœ€è¿‘ç”±äºè‡ªå·±çš„ä¸ªäººåº”ç”¨å¢åŠ ï¼Œæ¯æ¬¡éƒ½éœ€è¦åœ¨æœåŠ¡å™¨æ‰‹åŠ¨å‘å¸ƒï¼Œè§‰å¾—ç‰¹åˆ«éº»çƒ¦ï¼Œæ‰€ä»¥æƒ³é€šè¿‡ä»£ç æ§åˆ¶è‡ªåŠ¨å‘å¸ƒï¼Œç›´æ¥é€‰æ‹©äº†**GitHub Action**ã€‚

**GitHub Action**æŒç»­é›†æˆæœåŠ¡ï¼Œç›®å‰å·²ç»å…è´¹å¼€æ”¾ä½¿ç”¨ï¼Œç”±äºå¤§éƒ¨åˆ†äººçš„ä¸ªäººé¡¹ç›®éƒ½æ˜¯æ”¾åœ¨githubä¸Šï¼Œé‚£ä¹ˆä½¿ç”¨å®ƒæ¥å‘å¸ƒã€æµ‹è¯•ã€éƒ¨ç½²ï¼Œæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚

## Github Actioné…ç½®

**ä¸‹é¢çš„å†…å®¹é»˜è®¤ä½ å·²ç»ä¼šåˆ›å»ºGithub Action**ï¼Œå®˜æ–¹æä¾›äº†å¾ˆå¤šGithub Action é…ç½®æ¨¡ç‰ˆï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚éšæ„é€‰æ‹©ï¼Œä¸æ˜¯å¤ªäº†è§£çš„å¯ä»¥å…ˆå‚è€ƒ[**é˜®ä¸€å³° GitHub Actionså…¥é—¨æ•™ç¨‹**](http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)ï¼Œäº†è§£ä¸€ä¸‹Github Actionã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹Github Actioné…ç½®æ–‡ä»¶çš„åŸºæœ¬æ„æˆï¼Œé…ç½®æ–‡ä»¶æ ¼å¼æ˜¯```.yml```ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```yml
# main.yml
# ä¸€ä¸ª workflowï¼Œåå­—ä¸ºGithub Action Example
name: Github Action Example

# è§¦å‘ workflow çš„äº‹ä»¶
on:
  push:
    # åˆ†æ”¯éšæ„
    branches:
      - master

# ä¸€ä¸ªworkflowç”±æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹job
jobs:
    # ä¸€ä¸ªjobä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºbuild
    build:
        # runs-on æŒ‡å®šjobä»»åŠ¡è¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒ(å¿…å¡«å­—æ®µ)
        runs-on: ubuntu-latest
        # stepsæ˜¯æ¯ä¸ªJobçš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤
        steps:
            # actionå‘½ä»¤ï¼Œåˆ‡æ¢åˆ†æ”¯è·å–æºç 
            - name: Checkout
                # ä½¿ç”¨actionåº“  actions/checkoutè·å–æºç 
                uses: actions/checkout@master
            # actionå‘½ä»¤ï¼Œå®‰è£…Node10
            - name: use Node.js 10
                # ä½¿ç”¨actionåº“  actions/setup-nodeå®‰è£…node
                uses: actions/setup-node@v1
                with:
                    node-version: 10
            # actionå‘½ä»¤ï¼Œinstall && test
            - name: npm install and test
                # è¿è¡Œçš„å‘½ä»¤æˆ–è€… action
                run: |
                    npm install
                    npm run test
                # ç¯å¢ƒå˜é‡
                env:
                    CI: true
```
* **Action**æ˜¯å·¥ä½œæµä¸­æœ€å°çš„å¯ç§»æ¤æ„å»ºå—ã€‚ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„åŠ¨ä½œï¼Œä½¿ç”¨ä»[GitHubç¤¾åŒºå…±äº«çš„actionåº“](https://github.com/marketplace?utf8=%E2%9C%93&type=actions&query=deploy)ï¼Œä»¥åŠè‡ªå®šä¹‰å…¬å…±actionåº“ã€‚

* **Step**æ˜¯Jobæ‰§è¡Œçš„ä¸€ç»„ä»»åŠ¡ã€‚Jobä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½åœ¨åŒä¸€è¿è¡Œç¨‹åºä¸­æ‰§è¡Œï¼Œä»è€Œå…è®¸è¯¥Jobä¸­çš„æ“ä½œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå…±äº«ä¿¡æ¯ï¼ŒStepå¯ä»¥è¿è¡Œå‘½ä»¤æˆ–actionã€‚

* **Job**ç”±Stepæ„æˆã€‚ä½ å¯ä»¥å®šä¹‰å·¥ä½œæµæ–‡ä»¶ä¸­Jobçš„è¿è¡Œæ–¹å¼çš„ä¾èµ–å…³ç³»è§„åˆ™ã€‚Jobå¯ä»¥åŒæ—¶å¹¶è¡Œè¿è¡Œï¼Œä¹Ÿå¯ä»¥ä¾èµ–äºå…ˆå‰Jobçš„çŠ¶æ€ä¾æ¬¡è¿è¡Œã€‚

* **Workflow**ç”±ä¸€ä¸ªæˆ–å¤šä¸ªJobç»„æˆï¼Œå¯ä»¥é€šè¿‡[äº‹ä»¶](https://help.github.com/cn/actions/automating-your-workflow-with-github-actions/events-that-trigger-workflows)è¿›è¡Œè®¡åˆ’æˆ–æ¿€æ´»ã€‚ä½ å¯ä»¥åœ¨å­˜å‚¨åº“ä¸­è®¾ç½®ä¸€ä¸ªå¯é…ç½®çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ï¼Œä»¥åœ¨GitHubä¸Šæ„å»ºï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒæˆ–éƒ¨ç½²ä»»ä½•é¡¹ç›®ã€‚

[Github: Github Actionæ’ä»¶æŸ¥è¯¢åº“](https://github.com/marketplace?utf8=%E2%9C%93&type=actions&query=deploy)ï¼Œå¯ä»¥æŸ¥è¯¢ä½ éœ€è¦çš„actionåº“ï¼Œè¿™äº›éƒ½æ˜¯å…±äº«çš„ï¼Œå¦‚æœæ»¡è¶³ä¸äº†éœ€æ±‚ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ã€‚

## Github Actionå‘å¸ƒé˜¿é‡Œäº‘ECS

ä¸‹é¢å°±æ˜¯æˆ‘å‘å¸ƒåˆ°é˜¿é‡Œäº‘ECSçš„ Github Actioné…ç½®æ–‡ä»¶

> [æˆ‘çš„Github ActionæœåŠ¡é…ç½®](https://github.com/HerryLo/BlogPress/blob/master/.github/workflows/main.yml)

```yml
# main.yml
name: deploy to aliyun
on:
  push:
    branches:
      - master
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # åˆ‡æ¢åˆ†æ”¯
      - name: Checkout
        uses: actions/checkout@master
      # ä¸‹è½½ git submodule
      - uses: srt32/git-actions@v0.0.3
        with:
          args: git submodule update --init --recursive
      # ä½¿ç”¨ node:10
      - name: use Node.js 10
        uses: actions/setup-node@v1
        with:
          node-version: 10
      # npm install
      - name: npm install and build
        run: |
          npm install
          npm run build
        env:
          CI: true
      # Deploy
      - name: Deploy
        uses: easingthemes/ssh-deploy@v2.0.7
        env:
          SSH_PRIVATE_KEY: ${{ secrets.ACCESS_TOKEN }}
          ARGS: "-avz --delete"
          SOURCE: "[Current File Dir]"
          REMOTE_HOST: "[Domain]"
          REMOTE_USER: "[UserName]"
          TARGET: "[Server Dir]"
```
ä»¥ä¸Šæ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶ï¼Œactionæ’ä»¶è¯·æ ¹æ®è‡ªå·±çš„éœ€æ±‚åˆç†é€‰æ‹©ã€‚æˆ‘æ˜¯è¦åšå®¢ç½‘ç«™ï¼Œå‘å¸ƒåˆ°é˜¿é‡Œäº‘æœåŠ¡ä¸Šï¼Œæ‰€ä»¥é‡‡ç”¨ä»¥ä¸Šé…ç½®ï¼Œè€Œæœ€åçš„action Deployä¸­actionæ’ä»¶çš„é€‰æ‹©ï¼Œä¹Ÿæ˜¯æ ¹æ®éœ€æ±‚ï¼Œåœ¨[Github: actionæ’ä»¶åº“](https://github.com/marketplace?utf8=%E2%9C%93&type=actions&query=deploy)ä¸­é€‰æ‹©çš„ã€‚

ï¼ˆ**è¡¥å……æ³¨æ„âš ï¸**ï¼šå¦‚æœä½ æ˜¯è¦å‘å¸ƒåˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨ä»¥ä¸Šé…ç½®actionæ–‡ä»¶ï¼Œè¯·è®°ä½ï¼š**ACCESS_TOKEN æ˜¯æœåŠ¡å™¨sshå¯†é’¥å¯¹çš„ç§é’¥éƒ¨åˆ†**ï¼›**åº”å°†æœåŠ¡å™¨å…¬é’¥éƒ¨åˆ†æ·»åŠ åˆ°æ¥æ”¶éƒ¨ç½²çš„æœåŠ¡å™¨ä¸Šçš„authorized_keysæ–‡ä»¶ä¸­**ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œ**ACCESS_TOKEN æ˜¯ æœåŠ¡å™¨ ï½/.sshç›®å½•ä¸‹çš„id_rsa æ–‡ä»¶ä¸­ çš„å†…å®¹**ã€‚ä»”ç»†çœ‹ä¸€ä¸‹[https://github.com/marketplac...](https://github.com/marketplace/actions/ssh-deploy#configuration) æ–‡æ¡£ä¸­çš„å­—æ®µé…ç½®æè¿°ğŸ˜“ï¼‰

## æœ€æ–°æ›´æ–°20220424
ç”±äºgithubs action å®‰å…¨å‡çº§çš„åŸå› ï¼Œæˆ‘å‘ç°æœ‰äº†è¿™ä¸ªæŠ¥é”™ï¼š

```
Starting the git Action
fatal: unsafe repository ('/github/workspace' is owned by someone else)
To add an exception for this directory, call:

	git config --global --add safe.directory /github/workspace
```
![](/image/ddd24.png)

æŒ‰ç…§æç¤ºä¿®æ”¹é…ç½®ï¼Œä¹Ÿåœ¨ç½‘ä¸ŠæŸ¥æ‰¾äº†å¾ˆå¤šåŠæ³•ï¼Œéƒ½ä¸å¤ªè¡Œï¼Œæœ€åå†³å®šå°†  srt32/git-actions@v0.0.3 ç§»é™¤äº†

```
- - uses: srt32/git-actions@v0.0.3
-        with:
-         args: git submodule update --init --recursive
```

## æ›´å¤š

[ä½¿ç”¨GitHub Actionså‘å¸ƒHexoç½‘ç«™åˆ°GitHub Pages](https://juejin.im/post/5da03d5e6fb9a04e046bc3a2)

[GitHub Actionså‘å¸ƒåšå®¢åˆ°é˜¿é‡Œäº‘OSS](https://juejin.im/post/5ddb2cabe51d45232250b8b3#heading-12)

[GitHub Actionsè‡ªåŠ¨æ„å»ºé•œåƒå¹¶æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡](https://athorx.com/posts/%E8%81%8A%E6%8A%80%E6%9C%AF/20191007-%E4%BD%BF%E7%94%A8github-actions%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1.html)

## å‚è€ƒ

[Core concepts for GitHub Actions](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/core-concepts-for-github-actions)

[é˜®ä¸€å³°: GitHub Actions å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)

ps: å¾®ä¿¡å…¬ä¼—å·ï¼šYopaiï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…³æ³¨ï¼Œæ¯å‘¨ä¸å®šæœŸæ›´æ–°ã€‚ä¸æ–­åˆ†äº«ï¼Œä¸æ–­è¿›æ­¥

![](/webChat1.png)
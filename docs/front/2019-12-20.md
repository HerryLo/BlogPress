---
title: 'ğŸ”¥react-reduxåŸç†è§£æ'
description: HerryLo, å¾®ä¿¡å…¬ä¼—å·ï¼š Yopai
data: 2019-12-20 11:40
tags: react-reduxï¼ŒåŸç†è§£æ
---

# react-reduxåŸç†è§£æ

åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­å·²è®²è¿‡[redux åŸç†è§£æ](https://didiheng.com/front/2019-10-26.html)ï¼Œæˆ‘å°†```redux```è¿”å›çš„storeå¯¹è±¡æŒ‚è½½åœ¨windowä¸­ï¼Œä¸æ˜¯å¤ªæ‡‚çš„åŒå­¦å¯ä»¥çœ‹çœ‹ä¹‹å‰çš„[redux åŸç†è§£æ](https://didiheng.com/front/2019-10-26.html)ã€‚

```javascript
const reducer = combineReducers({
    home: homeNumber,
    number: addNumber
})
const store = createStore(reducer)
window.$reduxStore = store

// ä½¿ç”¨
window.$reduxStore.dispatch(action);
let { state } = window.$reduxStore.getState()
```
ä½†åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œä¸€èˆ¬å´æ˜¯å°†```redux+c```é…åˆä½¿ç”¨ï¼Œä¸‹é¢å°±ä¸€èµ·æ¥è§£æ```react-redux```å¸¸ä½¿ç”¨çš„æ–¹æ³•ã€‚<span style="color: red;font-weight: 900;">ã€ä¸‹é¢æ˜¯ä»¥æœ€æ–°ç‰ˆæœ¬react-redux@7.1.3åº“è§£æã€‘</span>

## Providerå‡½æ•°

```react-redux```æä¾›äº†```<Provider />```ç”¨æ¥æŒ‚è½½reduxè¿”å›çš„storeå¯¹è±¡ï¼Œåªéœ€è¦æ³¨å…¥ä¸€æ¬¡ã€‚

```javascript
ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  rootElement
)
```
ä¸‹é¢çœ‹çœ‹```<Provider />```åšäº†ä»€ä¹ˆï¼š

```javascript
function Provider({ store, context, children }) {
  // ä¾èµ–é¡¹storeå˜åŒ–è§¦å‘ï¼Œè¿”å›storeå’Œsubscription
  const contextValue = useMemo(() => {
    // ç¡®ä¿åœ¨åä»£ä¹‹å‰é‡æ–°æ¸²æŸ“ç¥–å…ˆç»„ä»¶
    const subscription = new Subscription(store)
    subscription.onStateChange = subscription.notifyNestedSubs
    return {
      store,
      subscription
    }
  }, [store])
  // ä¾èµ–é¡¹storeå˜åŒ–è§¦å‘
  const previousState = useMemo(() => store.getState(), [store])

  // ä¾èµ–é¡¹contextValue, previousStateå˜åŒ–è§¦å‘
  useEffect(() => {
    const { subscription } = contextValue
    subscription.trySubscribe()

    if (previousState !== store.getState()) {
      subscription.notifyNestedSubs()
    }
    return () => {
      // ç»„ä»¶é”€æ¯æ¸…é™¤ç›‘å¬
      subscription.tryUnsubscribe()
      subscription.onStateChange = null
    }
  }, [contextValue, previousState])
  // ReactReduxContext = React.createContext(null)
  const Context = context || ReactReduxContext

  return <Context.Provider value={contextValue}>{children}</Context.Provider>
}
```
åœ¨åŸåº”ç”¨ç»„ä»¶ä¸ŠåŒ…è£¹ä¸€å±‚ï¼Œä½¿åŸæ¥æ•´ä¸ªåº”ç”¨æˆä¸ºProviderçš„å­ç»„ä»¶ï¼Œ[Context.Provider API](https://zh-hans.reactjs.org/docs/context.html#contextprovider)ï¼šå½“ Provider çš„ value å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚


## connectå‡½æ•°

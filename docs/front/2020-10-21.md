---
title: Axioséƒ¨åˆ†æºç è§£æ--æ‹¦æˆªå™¨
description: HerryLo, å¾®ä¿¡å…¬ä¼—å·ï¼š Yopai
date: 2020-10-21 11:55
tags: 
  - Axios
---
# Axioséƒ¨åˆ†æºç è§£æ--æ‹¦æˆªå™¨

[ä½œè€…ï¼šHerryLo](https://github.com/HerryLo)
[åšå®¢åŸæ–‡é“¾æ¥](https://github.com/AttemptWeb/Record/issues/26)

åœ¨Axiosä¸­æ‹¦æˆªå™¨æ˜¯å¦‚ä½•æ³¨å†Œå’Œè°ƒç”¨çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹

**æµè§ˆå™¨ç«¯Axios**è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š

```
åˆå§‹åŒ–Axiosâ€”â€”> æ³¨å†Œæ‹¦æˆªå™¨ â€”â€”> è¯·æ±‚æ‹¦æˆªâ€”â€”> ajaxè¯·æ±‚ â€”â€”> å“åº”æ‹¦æˆª â€”â€”> è¯·æ±‚å“åº”å›è°ƒ
```

## Axiosåˆå§‹åŒ–

ç¬¬ä¸€æ­¥ï¼šå½“ç„¶è°ƒç”¨Axiosè¯·æ±‚æ—¶åˆå§‹åŒ–äº†

```javascript
// åˆå§‹åŒ–Axios
function Axios(instanceConfig) {
  this.defaults = instanceConfig;
  this.interceptors = {
    request: new InterceptorManager(),
    response: new InterceptorManager()
  };
}

module.exports = Axios;
```
InterceptorManagerå’ŒInterceptorManagerå‡½æ•°åˆ†åˆ«æ˜¯æ˜¯requestæ‹¦æˆªå™¨å’Œresponseæ‹¦æˆªå™¨ï¼Œæ³¨å†Œæ‹¦æˆªå™¨å›è°ƒå‡½æ•°ï¼Œ**è¿™é‡Œåªä¼šè®²/*è¯·æ±‚æ‹¦æˆªå™¨*/ï¼Œå› ä¸ºå“åº”æ‹¦æˆªå™¨åŸºæœ¬ä¹Ÿæ˜¯è¿™ä¸ªæµç¨‹**ï¼›è¿™æ ·æˆ‘ä»¬ä½¿ç”¨`axios.request.use`æ¥æ·»åŠ æ‹¦æˆªå™¨å‡½æ•°æ—¶ï¼Œå®é™…å°±æ˜¯`InterceptorManager`å®ä¾‹å¯¹è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œ`InterceptorManager`å‡½æ•°åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ

## InterceptorManageræ³¨å†Œæ‹¦æˆªå‡½æ•°

```javascript
function InterceptorManager() {
  this.handlers = [];
}

//è´Ÿè´£å°†æ‹¦æˆªå›è°ƒå‡½æ•°ä¿å­˜åœ¨handlersä¸­
InterceptorManager.prototype.use = function use(fulfilled, rejected) {
  this.handlers.push({
    fulfilled: fulfilled,
    rejected: rejected
  });
  return this.handlers.length - 1;
};
```
é€šè¿‡`axios.request.use`å’Œ`axios.response.use`è¯·æ±‚ã€å›è°ƒæ‹¦æˆªå™¨æ·»åŠ æ‹¦æˆªå™¨ï¼Œå®é™…å°±æ˜¯è°ƒç”¨ç”¨`InterceptorManager`ä¸‹çš„`use`æ–¹æ³•ï¼Œå°†å›è°ƒå‡½æ•°ä¿å­˜åœ¨`this.handlers`æ•°ç»„ä¸­ã€‚

## è°ƒç”¨æ‹¦æˆªå™¨å‡½æ•°å’Œè¯·æ±‚å‡½æ•°

ä¸€ä¸‹å°±æ˜¯è°ƒç”¨è¯·æ±‚çš„å®é™…ä»£ç ï¼Œè°ƒç”¨`Axios`ä¸‹çš„`request`æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿä¼šå…ˆè¿›è¡Œä¸€æ¬¡å‚æ•°åˆå¹¶
```javascript
this.request(mergeConfig(config || {}, {
  method: method,
  url: url,
  data: (config || {}).data
}));
```

ä¸‹é¢å°±æ˜¯`request`æ–¹æ³•çš„å®é™…ä»£ç ï¼Œå¦‚ä¸‹ï¼š
```javascript
Axios.prototype.request = function request(config) {
  // dispatchRequestå‡½æ•°å³ajaxè¯·æ±‚å‡½æ•°
  var chain = [dispatchRequest, undefined];
  var promise = Promise.resolve(config);

  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {
      chain.unshift(interceptor.fulfilled, interceptor.rejected);
  });

  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {
      chain.push(interceptor.fulfilled, interceptor.rejected);
  });

  // ç»„è£… Promise è°ƒç”¨é“¾,å®Œæˆé“¾å¼è°ƒç”¨
  while (chain.length) {
      promise = promise.then(chain.shift(), chain.shift());
  }

  return promise;
};
```
åœ¨ä¸Šé¢çš„ä»£ç ä¸­`chain`å˜é‡çš„å®é™…å€¼æ˜¯è¿™æ ·çš„ï¼š
```javascript
chain = [è¯·æ±‚å›è°ƒæ‹¦æˆªå‡½æ•°, è¯·æ±‚å¼‚å¸¸å›è°ƒæ‹¦æˆªå‡½æ•°, dispatchRequest, undefined, å“åº”å›è°ƒæ‹¦æˆªå‡½æ•°, å“åº”å¼‚å¸¸å›è°ƒæ‹¦æˆªå‡½æ•° ]
```
ç„¶åé€šè¿‡å¾ªç¯ï¼Œä½¿ç”¨`Promiseé“¾å¼è°ƒç”¨`ï¼Œæ¥å®Œæˆ`è¯·æ±‚æ‹¦æˆªâ€”â€”> ajaxè¯·æ±‚ â€”â€”> å“åº”æ‹¦æˆª`çš„åŠŸèƒ½ï¼Œæœ€åå°†ç»“æœ`return`å‡ºæ¥ï¼Œéå¸¸çš„å·§å¦™ï¼ï¼

çœ‹ä¸‹é¢çš„å°±ç†è§£äº†ğŸ‘‡
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12cbfa5ce9aa4983b80a039eb5e5d83b~tplv-k3u1fbpfcp-zoom-1.image)
<center>ï¼ˆå›¾æ¥æºè‡ªè½¬è½½ï¼‰</center>

å‚è€ƒï¼š

[77.9K Star çš„ Axios é¡¹ç›®æœ‰å“ªäº›å€¼å¾—å€Ÿé‰´çš„åœ°æ–¹](https://juejin.im/post/6885471967714115597#heading-3)

[Axiosæ‹¦æˆªå™¨æ ¸å¿ƒæºç ](https://github.com/axios/axios/blob/master/lib/core/Axios.js#L27)

**ps**: å¾®ä¿¡å…¬ä¼—å·ï¼šYopaiï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…³æ³¨ï¼Œæ¯å‘¨ä¸å®šæœŸæ›´æ–°ã€‚ä¸æ–­åˆ†äº«ï¼Œä¸æ–­è¿›æ­¥

![](/webChat1.png)


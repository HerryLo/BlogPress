---
title: Axioséƒ¨åˆ†æºç è§£æ--æ‹¦æˆªå™¨
description: HerryLo, å¾®ä¿¡å…¬ä¼—å·ï¼š Yopai
date: 2020-10-21 11:55
tags: Axios
---

åœ¨Axiosä¸­æ‹¦æˆªå™¨æ˜¯å¦‚ä½•æ³¨å†Œå’Œè°ƒç”¨çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¾èµ–æ¥çœ‹çœ‹

æµè§ˆå™¨ç«¯Axiosè°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š

```
åˆå§‹åŒ–Axiosâ€”â€”> æ³¨å†Œæ‹¦æˆªå™¨ â€”â€”> è¯·æ±‚æ‹¦æˆªâ€”â€”> ajaxè¯·æ±‚ â€”â€”> å“åº”æ‹¦æˆª â€”â€”> è¯·æ±‚å“åº”å›è°ƒ
```

## Axiosåˆå§‹åŒ–

ç¬¬ä¸€æ­¥ï¼šå½“ç„¶è°ƒç”¨Axiosè¯·æ±‚æ—¶åˆå§‹åŒ–äº†

```javascript
// åˆå§‹åŒ–Axios
function Axios(instanceConfig) {
  this.defaults = instanceConfig;
  this.interceptors = {
    request: new InterceptorManager(),
    response: new InterceptorManager()
  };
}

module.exports = Axios;
```
InterceptorManagerå’ŒInterceptorManagerå‡½æ•°åˆ†åˆ«æ˜¯æ˜¯requestæ‹¦æˆªå™¨å’Œresponseæ‹¦æˆªå™¨ï¼Œæ³¨å†Œæ‹¦æˆªå™¨å›è°ƒå‡½æ•°ï¼Œ**è¿™é‡Œåªä¼šè®²/*è¯·æ±‚æ‹¦æˆªå™¨*/ï¼Œå› ä¸ºå“åº”æ‹¦æˆªå™¨åŸºæœ¬ä¹Ÿæ˜¯è¿™ä¸ªæµç¨‹**ï¼›è¿™æ ·æˆ‘ä»¬å°†`this.interceptors.request.use`æ¥æ·»åŠ æ‹¦æˆªå™¨å‡½æ•°äº†ï¼Œé‚£ä¹ˆè¿™é‡Œ`InterceptorManager`å‡½æ•°åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ

## InterceptorManageræ³¨å†Œæ‹¦æˆªå‡½æ•°

```javascript
function InterceptorManager() {
  this.handlers = [];
}

//è´Ÿè´£å°†æ‹¦æˆªå›è°ƒå‡½æ•°ä¿å­˜åœ¨handlersä¸­
InterceptorManager.prototype.use = function use(fulfilled, rejected) {
  this.handlers.push({
    fulfilled: fulfilled,
    rejected: rejected
  });
  return this.handlers.length - 1;
};
```
ä¸è®ºè¯·æ±‚è¿˜æ˜¯å›è°ƒæ‹¦æˆªå™¨ï¼Œéƒ½æ˜¯é€šè¿‡`InterceptorManager`å‡½æ•°æ¥å®Œæˆçš„ã€‚

## ## è°ƒç”¨æ‹¦æˆªå™¨å‡½æ•°å’Œè¯·æ±‚å‡½æ•°

```javascript
utils.forEach(['delete', 'get', 'head', 'options'], function forEachMethodNoData(method) {
  /*eslint func-names:0*/
  Axios.prototype[method] = function(url, config) {
    return this.request(mergeConfig(config || {}, {
      method: method,
      url: url,
      data: (config || {}).data
    }));
  };
});
```
`this.request`è´Ÿè´£è§¦å‘æ‹¦æˆªå™¨å‡½æ•°å’Œajaxè¯·æ±‚å‡½æ•°ï¼Œç»§ç»­å‘ä¸‹çœ‹

```javascript
Axios.prototype.request = function request(config) {
  // dispatchRequestå‡½æ•°å³ajaxè¯·æ±‚å‡½æ•°
  var chain = [dispatchRequest, undefined];
  var promise = Promise.resolve(config);

  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {
      chain.unshift(interceptor.fulfilled, interceptor.rejected);
  });

  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {
      chain.push(interceptor.fulfilled, interceptor.rejected);
  });

  // ç»„è£… Promise è°ƒç”¨é“¾,å®Œæˆé“¾å¼è°ƒç”¨
  while (chain.length) {
      promise = promise.then(chain.shift(), chain.shift());
  }

  return promise;
};
```

çœ‹ä¸‹é¢çš„å°±ç†è§£äº†ğŸ‘‡
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12cbfa5ce9aa4983b80a039eb5e5d83b~tplv-k3u1fbpfcp-zoom-1.image)
<center>ï¼ˆå›¾æ¥æºè‡ªè½¬è½½ï¼‰</center>

å‚è€ƒï¼š

[77.9K Star çš„ Axios é¡¹ç›®æœ‰å“ªäº›å€¼å¾—å€Ÿé‰´çš„åœ°æ–¹](https://juejin.im/post/6885471967714115597#heading-3)

[Axiosæ‹¦æˆªå™¨æ ¸å¿ƒæºç ](https://github.com/axios/axios/blob/master/lib/core/Axios.js#L27)

